<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: RISC-V-main/rtl/as_rv32i_decoder.v Source File</title>
<link href="tabs.vss" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.vss" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.vss" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.vss" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('as__rv32i__decoder_8v_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">as_rv32i_decoder.v</div></div>
</div><!--header-->
<div class="contents">
<a href="as__rv32i__decoder_8v.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span>//////////////////////////////////////////////////////////////////////////////////</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span>// Company: UQAC</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span>// Engineer: SHACHA</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>// </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>// Create Date: 07/07/2023 06:37:26 PM</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span>// Design Name: </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>// Module Name: as_rv32i_fetch</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>// Project Name: </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>// Target Devices: </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>// Tool Versions: </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>// Description: Pipeline Stage 2 decodes instruction [DECODE STAGE]</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>/*</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>   The as_rv32i_decoder module is in charge of decoding the 32-bit RISC-V RV32I instructions, generating the necessary control signals, and extracting the operand addresses and immediate values required by the RISC-V processor&#39;s execution stage.</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>   This module has numerous important components:</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> - Extraction of operand addresses: The module extracts the source and destination register addresses (rs1, rs2, and rd) from the input instruction. In the following stage of the pipeline, these addresses are utilised to access the register file.</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> - Immediate value extraction: Depending on the instruction type, this module extracts and sign-extends the input instruction&#39;s immediate value (imm). This value serves as an operand for arithmetic or load/store instructions, as well as an offset for branch and jump instructions.</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> - ALU operation decoding: The module decodes the required ALU operation based on the instruction&#39;s opcode and funct3 fields. It sets the proper signals (alu_add_d, alu_sub_d, alu_slt_d, and so on) to indicate which operation should be performed in the ALU during the execution stage.</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> - Decoding of opcode types: The module determines the kind of instruction depending on its opcode (opcode_rtype_d, opcode_itype_d, opcode_load_d, and so on). These signals are employed in the pipeline&#39;s subsequent stages to manage the flow of data and determine the necessary procedures.</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> - Exception decoding: The module looks for illegal instructions, system instructions (ECALL, EBREAK, and MRET), and shift operations that are not supported. If any of these requirements is met, the relevant exception signals (o_exception) are activated.</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> - Pipeline control: The module can stall and flush pipelines. If the pipeline&#39;s next step (i_stall) is stalled, the module will stall the decode stage (o_stall) and prevent the output registers from being updated. If the module receives a flush signal (i_flush), it will flush its internal state and disable the clock enable signal (o_ce) for the following step.</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>*/ </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>// Dependencies: </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>// </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>// Revision:</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>// Revision 0.01 - File Created</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>// Additional Comments:</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>// </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>//////////////////////////////////////////////////////////////////////////////////</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>`timescale 1ns / 1ps</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>`default_nettype none</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>`include &quot;as_rv32i_header.vh&quot;</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>module as_rv32i_decoder(</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    input wire i_clk,i_rst_n,</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    input wire[31:0] i_inst,                        //  32 bit instruction input</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    input wire[31:0] i_pc,                          //  PC value from previous stage</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    output reg[31:0] o_pc,                          //  PC value</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    output wire[4:0] o_rs1_addr,                    //  Address for register source 1</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    output reg[4:0] o_rs1_addr_q,                   //  Registered address for register source 1</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    output wire[4:0] o_rs2_addr,                    //  Address for register source 2</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    output reg[4:0] o_rs2_addr_q,                   //  Registered address for register source 2</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    output reg[4:0] o_rd_addr,                      //  Address for destination address</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    output reg[31:0] o_imm,                         //  Extended value for immediate</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    output reg[2:0] o_funct3,                       //  Function type</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    output reg[`ALU_WIDTH-1:0] o_alu,               //  ALU operation type</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    output reg[`OPCODE_WIDTH-1:0] o_opcode,         //  Op-code type</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    output reg[`EXCEPTION_WIDTH-1:0] o_exception,   //  Exceptions: illegal inst, ecall, ebreak, mret</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    /// Pipeline Control ///</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    input wire i_ce,    //  input clk enable for pipeline stalling of this stage</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    output reg o_ce,    //  output clk enable for pipeline stalling of next stage</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    input wire i_stall, //  informs this stage to stall</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    output reg o_stall, //  informs pipeline to stall</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    input wire i_flush, //  flush this stage</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    output reg o_flush  //  flush previous stages</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>);</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    assign o_rs2_addr = i_inst[24:20];  //  Since the as_rv32i_basereg module does the registering, o_rs1_addr and o_rs2_addr are not registered here.</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    wire[2:0] funct3_d = i_inst[14:12];</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    wire[6:0] opcode = i_inst[6:0];</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    reg[31:0] imm_d;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    reg alu_add_d;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    reg alu_sub_d;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    reg alu_slt_d;</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    reg alu_sltu_d;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    reg alu_xor_d;</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    reg alu_or_d;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    reg alu_and_d;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    reg alu_sll_d;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    reg alu_srl_d;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    reg alu_sra_d;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    reg alu_eq_d; </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    reg alu_neq_d;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    reg alu_ge_d; </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    reg alu_geu_d;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    reg opcode_rtype_d;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    reg opcode_itype_d;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    reg opcode_load_d;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    reg opcode_store_d;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    reg opcode_branch_d;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    reg opcode_jal_d;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    reg opcode_jalr_d;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    reg opcode_lui_d;</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    reg opcode_auipc_d;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    reg opcode_system_d;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    reg opcode_fence_d;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    reg system_noncsr = 0;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    reg valid_opcode = 0;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    reg illegal_shift = 0;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    wire stall_bit = o_stall || i_stall; //stall this stage when next stages are stalled</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    // Register the decoder module&#39;s outputs for shorter combinational timing pathways</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    always @(posedge i_clk, negedge i_rst_n) begin</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        if(!i_rst_n) begin</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            o_ce &lt;= 0;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        end</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        else begin</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            if(i_ce &amp;&amp; !stall_bit) begin // Update registers only if this stage is enabled and pipeline is not stalled</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                o_pc         &lt;= i_pc;</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                o_rs1_addr_q &lt;= o_rs1_addr;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                o_rs2_addr_q &lt;= o_rs2_addr;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                o_rd_addr    &lt;= i_inst[11:7];</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                o_funct3     &lt;= funct3_d;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                o_imm        &lt;= imm_d;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                /// ALU Operations ////</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                o_alu[`ADD]  &lt;= alu_add_d;</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                o_alu[`SUB]  &lt;= alu_sub_d;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                o_alu[`SLT]  &lt;= alu_slt_d;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                o_alu[`SLTU] &lt;= alu_sltu_d;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                o_alu[`XOR]  &lt;= alu_xor_d;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                o_alu[`OR]   &lt;= alu_or_d; </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                o_alu[`AND]  &lt;= alu_and_d;</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                o_alu[`SLL]  &lt;= alu_sll_d; </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                o_alu[`SRL]  &lt;= alu_srl_d;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                o_alu[`SRA]  &lt;= alu_sra_d;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>                o_alu[`EQ]   &lt;= alu_eq_d; </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>                o_alu[`NEQ]  &lt;= alu_neq_d;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>                o_alu[`GE]   &lt;= alu_ge_d; </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>                o_alu[`GEU]  &lt;= alu_geu_d;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                          </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>                o_opcode[`RTYPE]  &lt;= opcode_rtype_d;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>                o_opcode[`ITYPE]  &lt;= opcode_itype_d;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>                o_opcode[`LOAD]   &lt;= opcode_load_d;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>                o_opcode[`STORE]  &lt;= opcode_store_d;</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>                o_opcode[`BRANCH] &lt;= opcode_branch_d;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>                o_opcode[`JAL]    &lt;= opcode_jal_d;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>                o_opcode[`JALR]   &lt;= opcode_jalr_d;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>                o_opcode[`LUI]    &lt;= opcode_lui_d;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>                o_opcode[`AUIPC]  &lt;= opcode_auipc_d;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>                o_opcode[`SYSTEM] &lt;= opcode_system_d;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                o_opcode[`FENCE]  &lt;= opcode_fence_d;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>                </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                /*********************** Decode possible exceptions ***********************/</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                o_exception[`ILLEGAL] &lt;= !valid_opcode || illegal_shift;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                // Check if ECALL</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                o_exception[`ECALL] &lt;= (system_noncsr &amp;&amp; i_inst[21:20]==2&#39;b00)? 1:0;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                // Check if EBREAK</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                o_exception[`EBREAK] &lt;= (system_noncsr &amp;&amp; i_inst[21:20]==2&#39;b01)? 1:0;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                // Check if MRET</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                 o_exception[`MRET] &lt;= (system_noncsr &amp;&amp; i_inst[21:20]==2&#39;b10)? 1:0;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                /***************************************************************************/</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            end</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            if(i_flush &amp;&amp; !stall_bit) begin // flush this stage so clock-enable of next stage is disabled at next clock cycle</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                o_ce &lt;= 0;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            end</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>            else if(!stall_bit) begin // clock-enable will change only when not stalled</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                o_ce &lt;= i_ce;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            end</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            else if(stall_bit &amp;&amp; !i_stall) o_ce &lt;= 0; // If this stage is stalled but the next stage is not, disable the following stage&#39;s clock enablement at the next clock cycle (pipeline bubble).</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        end</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    end</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    always @* begin</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        //// Opcode Type ////</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        opcode_rtype_d  = opcode == `OPCODE_RTYPE;</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        opcode_itype_d  = opcode == `OPCODE_ITYPE;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        opcode_load_d   = opcode == `OPCODE_LOAD;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        opcode_store_d  = opcode == `OPCODE_STORE;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        opcode_branch_d = opcode == `OPCODE_BRANCH;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        opcode_jal_d    = opcode == `OPCODE_JAL;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        opcode_jalr_d   = opcode == `OPCODE_JALR;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        opcode_lui_d    = opcode == `OPCODE_LUI;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        opcode_auipc_d  = opcode == `OPCODE_AUIPC;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        opcode_system_d = opcode == `OPCODE_SYSTEM;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        opcode_fence_d  = opcode == `OPCODE_FENCE;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        /*********************** Decode possible exceptions ***********************/</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        system_noncsr = opcode == `OPCODE_SYSTEM &amp;&amp; funct3_d == 0 ; //system instruction but not CSR operation</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        // Check if instruction is illegal    </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        valid_opcode = (opcode_rtype_d || opcode_itype_d || opcode_load_d || opcode_store_d || opcode_branch_d || opcode_jal_d || opcode_jalr_d || opcode_lui_d || opcode_auipc_d || opcode_system_d || opcode_fence_d);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        illegal_shift = (opcode_itype_d &amp;&amp; (alu_sll_d || alu_srl_d || alu_sra_d)) &amp;&amp; i_inst[25];</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    end</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>     // Decode operation for ALU and the extended value of immediate</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    always @* begin</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        o_stall = i_stall; // Stall previous stage when decoder needs wait time</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        o_flush = i_flush; // Flush this stage along with the previous stages </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        imm_d = 0;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        alu_add_d = 0;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        alu_sub_d = 0;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        alu_slt_d = 0;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        alu_sltu_d = 0;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        alu_xor_d = 0;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        alu_or_d = 0;</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        alu_and_d = 0;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        alu_sll_d = 0;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        alu_srl_d = 0;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        alu_sra_d = 0;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        alu_eq_d = 0; </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        alu_neq_d = 0;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        alu_ge_d = 0; </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        alu_geu_d = 0;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        /********************************** Decode ALU Operation **********************************/</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        if(opcode == `OPCODE_RTYPE || opcode == `OPCODE_ITYPE) begin</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            if(opcode == `OPCODE_RTYPE) begin</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>                alu_add_d = funct3_d == `FUNCT3_ADD ? !i_inst[30] : 0;  // add and sub has same o_funct3 code</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                alu_sub_d = funct3_d == `FUNCT3_ADD ? i_inst[30] : 0;   // differs on i_inst[30]</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            end</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            else alu_add_d = funct3_d == `FUNCT3_ADD;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            alu_slt_d   = funct3_d  == `FUNCT3_SLT;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            alu_sltu_d  = funct3_d  == `FUNCT3_SLTU;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            alu_xor_d   = funct3_d  == `FUNCT3_XOR;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            alu_or_d    = funct3_d  == `FUNCT3_OR;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            alu_and_d   = funct3_d  == `FUNCT3_AND;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            alu_sll_d   = funct3_d  == `FUNCT3_SLL;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            alu_srl_d   = funct3_d  == `FUNCT3_SRA ? (!i_inst[30]) : 0; // srl and sra has same o_funct3 code</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            alu_sra_d   = funct3_d  == `FUNCT3_SRA ?   i_inst[30]  : 0; // differs on i_inst[30]</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        end</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        else if(opcode == `OPCODE_BRANCH) begin</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            alu_eq_d    = funct3_d == `FUNCT3_EQ;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            alu_neq_d   = funct3_d == `FUNCT3_NEQ;    </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            alu_slt_d   = funct3_d == `FUNCT3_LT;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            alu_ge_d    = funct3_d == `FUNCT3_GE;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            alu_sltu_d  = funct3_d == `FUNCT3_LTU;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            alu_geu_d   = funct3_d == `FUNCT3_GEU;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        end</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        else alu_add_d = 1&#39;b1; // add operation for all remaining instructions</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        /********************************************************************************************/</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        /************************** Extend the immediate (o_imm) ************************************/</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        case(opcode)</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        `OPCODE_ITYPE , `OPCODE_LOAD , `OPCODE_JALR: imm_d = {{20{i_inst[31]}},i_inst[31:20]}; </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                                      `OPCODE_STORE: imm_d = {{20{i_inst[31]}},i_inst[31:25],i_inst[11:7]};</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                                     `OPCODE_BRANCH: imm_d = {{19{i_inst[31]}},i_inst[31],i_inst[7],i_inst[30:25],i_inst[11:8],1&#39;b0};</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                                        `OPCODE_JAL: imm_d = {{11{i_inst[31]}},i_inst[31],i_inst[19:12],i_inst[20],i_inst[30:21],1&#39;b0};</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                        `OPCODE_LUI , `OPCODE_AUIPC: imm_d = {i_inst[31:12],12&#39;h000};</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                     `OPCODE_SYSTEM , `OPCODE_FENCE: imm_d = {20&#39;b0,i_inst[31:20]};   </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                     default: imm_d = 0;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        endcase</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        /*********************************************************************************************/</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    end</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>endmodule</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_35191fc563656ec8e3f935b60461952d.html">RISC-V-main</a></li><li class="navelem"><a class="el" href="dir_2820ad9171bf05546b333ebb8bc9bb96.html">rtl</a></li><li class="navelem"><a class="el" href="as__rv32i__decoder_8v.html">as_rv32i_decoder.v</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
